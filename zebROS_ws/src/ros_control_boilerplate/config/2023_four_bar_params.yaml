four_bar_controller_2023:
    type: four_bar_controller_2023/FourBarController_2023

    feed_forward_map:
        - [-0.005745246393415549, 0.02737047898338221]
        - [0.047570640137480746, 0.04105571847507331]
        - [0.09904804782248407, 0.04594330400782014]
        - [0.1493764062288043, 0.0469208211143695]
        - [0.19993457449086113, 0.04887585532746823]
        - [0.2498033131857081, 0.050830889540566956]
        - [0.29944224202481845, 0.053763440860215055]
        - [0.34977060043113867, 0.053763440860215055]
        - [0.399409529270249, 0.05767350928641251]
        - [0.4501975073880425, 0.05278592375366569]
        - [0.49937681651567956, 0.053763440860215055]
        - [0.5494753650662632, 0.05278592375366569]
        - [0.5993441037611101, 0.05180840664711633]
        - [0.649902272023167, 0.05180840664711633]
        - [0.6993113910065407, 0.05767350928641251]
        - [0.7503291789800708, 0.05571847507331378]
        - [0.7999681078191812, 0.06158357771260997]
        - [0.8498368465140281, 0.06060606060606061]
        - [0.8990161556416651, 0.06451612903225806]
        - [0.9484252746250389, 0.06842619745845552]
        - [0.9999026823100422, 0.059628543499511244]
        - [1.049311801293416, 0.05865102639296188]
        - [1.0998699695554728, 0.05278592375366569]
        - [1.1485896589716367, 0.05767350928641251]
        - [1.1998372568009033, 0.04594330400782014]
        - [1.2490165659285404, 0.047898338220918865]
        - [1.299804544046334, 0.03616813294232649]
        - [1.3492136630297076, 0.03714565004887586]
        - [1.4006910707147109, 0.02737047898338221]
        - [1.4491809502751383, 0.02932551319648094]
        - [1.4999689283929316, 0.019550342130987292]
        - [1.5461607093959926, 0.01466275659824047]
        - [1.5997064057826256, -0.019550342130987292]
        - [1.6502645740446824, -0.028347996089931573]
        - [1.7001333127395295, -0.04105571847507331]
        - [1.7545982485491087, -0.047898338220918865]

    four_bar_joint: [ 'four_bar' ]
    dynamic_reconfigure: True
    min_angle: 0.0 # for sure. this is slightly less than vertical (it's where the limit switch hits)
    max_angle: 1.8 # measured

    # don't even care about lenghts because we are using angles


    # 0.11-0.12 worked well for holding max extension
    arb_feed_forward_angle: 0.10
    straight_up_angle: 0.0

    motion_magic_velocity: 15.0
    motion_magic_acceleration: 8.0

    # How quickly the four bar moves down when zeroing itself
    four_bar_zeroing_percent_output: -0.10

    # If there are no negative velocity readings while zeroing
    # for this amount of time, assume the four bar is stuck
    # or has hit bottom and the limit switch is broken.  Stop
    # trying to drive down to prevent killing the motor
    four_bar_zeroing_timeout:  2.0
    motion_s_curve_strength: 8
    four_bar:
        type: talon_controllers/TalonControllerInterface 
        joint: four_bar
        close_loop_values:
            # kinda forgot the tuning from saturday, but something like this?
            #- {p: 0.45, i: 0.0001, d: 4.0, f: 0.065, i_zone: 300, closed_loop_peak_output: 1.0, max_integral_accumulator: 600}
            - {p: 1.2, i: 0.000, d: 0.0, f: 0.065, i_zone: 125, closed_loop_peak_output: 1.0, max_integral_accumulator: 0.1}
        velocity_measurement_period: Period_10Ms
        velocity_measurement_window: 4
        invert_output: True
        sensor_phase: True
        
        neutral_mode: Brake

        feedback_type: IntegratedSensor

        limit_switch_local_reverse_source: "FeedbackConnector"
        limit_switch_local_reverse_normal: "NormallyOpen"

        # TODO : figure out what value this should be
        # Only need one direction, to
        # prevent the elevator from running off the top
        softlimit_forward_threshold: 1.5 #1.66755
        softlimit_forward_enable: False

        voltage_compensation_enable: True
        voltage_compensation_saturation: 12
        
        conversion_factor: 0.074906367 # set from chad
        neutral_deadband: 0.01 # set to be higher

        dynamic_reconfigure: True
        motion_s_curve_strength: 8
